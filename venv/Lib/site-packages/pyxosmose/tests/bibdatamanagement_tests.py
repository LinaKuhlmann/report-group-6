# All rights reserved. ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE, Switzerland,
# IPESE Laboratory, Copyright 2018
# This work can be distributed under the CC BY-NC-SA 4.0 License.
# See the LICENSE file for more details.
#
# Author: Michel Lopez <michel.lopez@epfl.ch>

import filecmp
import os
import tempfile
import unittest
from pathlib import Path

import pandas as pd

from pyxosmose.rosmose import Rosmose


class BibDataManagementTests(unittest.TestCase):

    def setUp(self):
        self.ro = Rosmose()
        self.bib_data_file = Path(__file__).parent.resolve() / "model" / "bibliography.bib"
        self.default = """{+- enhOR# default:[default, energyscope]: that's my general description
cmaint = 0.5:1:2 [MCHF/(ktCO2*y)]
cinv = 0:1 [MCHF/(ktCO2*y)]
refsize = 0 [GW]
gwp = 0 [kgCO2/kWe] # Ebom:I said Ebom
lifetime = 0 [y]
CO2c = 0 [ktCO2] # Ebom hahaha
+-"""

    def tearDown(self):
        pass

    def test_001_read_bib_data(self):
        data = self.ro.read_bib_data("test", str(self.bib_data_file), self.default)
        self.assertTrue(isinstance(data, pd.DataFrame))
        data = self.ro.get_bib_data_by_name("test").get_database()
        self.assertTrue(len(data) == 19)
        es = list(filter(lambda tech: "energyscope" in tech["sets"], data))
        self.assertTrue(len(es) == 9)
