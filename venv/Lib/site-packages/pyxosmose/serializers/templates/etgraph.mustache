digraph et {
    rankdir = LR
    newrank = true

    subgraph inlayers {
        rank = same
        {{#layers_in}}
        {{short_name}} [label='{{display_name}}', shape=cds, style=filled, color=black, fillcolor={{color}}]
        {{/layers_in}}
    }

    subgraph units {
        rank = same
        {{#units}}
        {{unitname}} [label=<
            <table border='0' collspacing='0'>
                <tr><td></td><td><b>{{unitname}}</b></td><td></td></tr>
                <tr><td></td></tr>
                {{#contains_heat}}
                <tr><td>Heat:</td></tr>
                {{#heat_streams}}
                {{#is_heat_constant}}
                <tr>
                    <td bgcolor='#d0c2d0'><font color='black'>{{tin}} {{tunit}}</font></td>
                    <td bgcolor='#d0c2d0'><font color='black'>{{hval}} {{hunit}}</font></td>
                    <td bgcolor='#d0c2d0'><font color='black'>{{tout}} {{tunit}}</font></td>
                 </tr>
                {{/is_heat_constant}}
                {{^is_heat_constant}}
                {{#is_heating}}
                <tr>
                    <td bgcolor='#9fc5e8:#ffe1e1'><font color='blue'>{{tin}} {{tunit}}</font></td>
                    <td bgcolor='#ffe1e1'><font color='black'>{{hval}} {{hunit}}</font></td>
                    <td bgcolor='#ffe1e1:#ff9898'><font color='red'>{{tout}} {{tunit}}</font></td>
                 </tr>
                {{/is_heating}}
                {{^is_heating}}
                <tr>
                    <td bgcolor='#ffe1e1:#9fc5e8'><font color='red'>{{tin}} {{tunit}}</font></td>
                    <td bgcolor='#9fc5e8'><font color='black'>{{hval}} {{hunit}}</font></td>
                    <td bgcolor='#9fc5e8:#5eb2ff'><font color='blue'>{{tout}} {{tunit}}</font></td>
                 </tr>
                {{/is_heating}}
                {{/is_heat_constant}}
                {{/heat_streams}}
                {{/contains_heat}}
                <tr><td></td></tr>
                <tr><td>Costs:</td></tr>
                 <tr>
                    <td>Op 1:</td>
                    <td></td>
                    <td>{{cost1}}</td>
                 </tr>
                 <tr>
                    <td>Op 2:</td>
                    <td></td>
                    <td>{{cost2}}</td>
                 </tr>
                 <tr>
                    <td>Inv 1:</td>
                    <td></td>
                    <td>{{cinv1}}</td>
                 </tr>
                 <tr>
                    <td>Inv 2:</td>
                    <td></td>
                    <td>{{cinv2}}</td>
                 </tr>
        </table>>, shape=box]
        {{/units}}
    }

    subgraph outlayers {
        rank = same
        {{#layers_out}}
        out{{short_name}} [label='{{display_name}}', shape=cds, style=filled, color=black, fillcolor={{color}}]
        {{/layers_out}}
    }

    {{#units}}
    {{#resource_streams}}
    {{#in_direction}}
    {{layer}} -> {{unitname}} [label='{{value}} [{{physical_unit}}]', color=black]
    {{/in_direction}}
    {{^in_direction}}
    {{unitname}} -> out{{layer}} [label='{{value}} [{{physical_unit}}]', color=black]
    {{/in_direction}}
    {{/resource_streams}}
    {{/units}}
}